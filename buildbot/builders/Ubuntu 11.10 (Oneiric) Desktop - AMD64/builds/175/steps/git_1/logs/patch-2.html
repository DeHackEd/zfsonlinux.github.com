<html>

<!-- Mirrored from pip.chaos:8010/builders/Ubuntu 11.10 (Oneiric) Desktop - AMD64/builds/175/steps/git_1/logs/patch by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 22 Aug 2011 19:29:20 GMT -->
<head><title>Log File contents</title>

<style type="text/css">
 div.data {
  font-family: "Courier New", courier, monotype;
 }
 span.stdout {
  font-family: "Courier New", courier, monotype;
 }
 span.stderr {
  font-family: "Courier New", courier, monotype;
  color: red;
 }
 span.header {
  font-family: "Courier New", courier, monotype;
  color: blue;
 }
</style>
</head>
<body vlink="#800080">
<a href="patch/texthtml-2.html">(view as text)</a><br />
<pre>
<span class="stdout">diff --git a/cmd/zfs/zfs_main.c b/cmd/zfs/zfs_main.c
index 5354477..82a6d56 100644
--- a/cmd/zfs/zfs_main.c
+++ b/cmd/zfs/zfs_main.c
@@ -4457,7 +4457,7 @@ construct_fsacl_list(boolean_t un, struct allow_opts *opts, nvlist_t **nvlp)
 
 		while (curr &lt; end) {
 			const char *who;
-			zfs_deleg_who_type_t who_type;
+			zfs_deleg_who_type_t who_type = ZFS_DELEG_WHO_UNKNOWN;
 			char *endch;
 			char *delim = strchr(curr, ',');
 			char errbuf[256];
@@ -4562,7 +4562,7 @@ print_set_creat_perms(uu_avl_t *who_avl)
 		deleg_perm_node_t *deleg_node;
 
 		if (prev_weight != weight) {
-			(void) printf(*title_ptr++);
+			(void) printf(&quot;%s&quot;, *title_ptr++);
 			prev_weight = weight;
 		}
 
@@ -4617,7 +4617,7 @@ print_uge_deleg_perms(uu_avl_t *who_avl, boolean_t local, boolean_t descend,
 				const char *who = NULL;
 				if (prt_title) {
 					prt_title = B_FALSE;
-					(void) printf(title);
+					(void) printf(&quot;%s&quot;, title);
 				}
 
 				switch (who_type) {
@@ -4676,7 +4676,7 @@ print_fs_perms(fs_perm_set_t *fspset)
 		(void) snprintf(buf, ZFS_MAXNAMELEN+32,
 		    gettext(&quot;---- Permissions on %s &quot;),
 		    node-&gt;fspn_fsperm.fsp_name);
-		(void) printf(dsname);
+		(void) printf(&quot;%s&quot;, dsname);
 		left = 70 - strlen(buf);
 		while (left-- &gt; 0)
 			(void) printf(&quot;-&quot;);
diff --git a/config/suppressed-warnings.txt b/config/suppressed-warnings.txt
new file mode 100644
index 0000000..13a1efd
--- /dev/null
+++ b/config/suppressed-warnings.txt
@@ -0,0 +1,6 @@
+#
+# Expected warnings which should be suppressed by buildbot
+#
+None : ^libtool: install: warning: relinking `.*'$
+None : ^libtool: install: warning: remember to run `libtool --finish .*'$
+None : ^libtool: install: warning: `.*' has not been installed in `.*'$
diff --git a/configure b/configure
index 8640242..d97d1ca 100755
--- a/configure
+++ b/configure
@@ -20744,7 +20744,7 @@ fi
 $as_echo &quot;$enable_debug&quot; &gt;&amp;6; }
 
 
-ac_config_files=&quot;$ac_config_files Makefile dracut/Makefile dracut/90zfs/Makefile udev/Makefile udev/rules.d/Makefile etc/Makefile etc/init.d/Makefile etc/init.d/zfs.arch etc/init.d/zfs.gentoo etc/init.d/zfs.lunar etc/init.d/zfs.fedora etc/init.d/zfs.lsb etc/init.d/zfs.redhat etc/zfs/Makefile man/Makefile man/man8/Makefile lib/Makefile lib/libspl/Makefile lib/libspl/asm-generic/Makefile lib/libspl/asm-i386/Makefile lib/libspl/asm-x86_64/Makefile lib/libspl/include/Makefile lib/libspl/include/ia32/Makefile lib/libspl/include/ia32/sys/Makefile lib/libspl/include/rpc/Makefile lib/libspl/include/sys/Makefile lib/libspl/include/sys/sysevent/Makefile lib/libspl/include/sys/dktp/Makefile lib/libspl/include/util/Makefile lib/libavl/Makefile lib/libefi/Makefile lib/libnvpair/Makefile lib/libunicode/Makefile lib/libuutil/Makefile lib/libzpool/Makefile lib/libzfs/Makefile lib/libshare/Makefile cmd/Makefile cmd/zdb/Makefile cmd/zfs/Makefile cmd/zinject/Makefile cmd/zpool/Makefile cmd/ztest/Makefile cmd/zpios/Makefile cmd/mount_zfs/Makefile cmd/zpool_layout/Makefile cmd/zvol_id/Makefile cmd/zpool_id/Makefile cmd/sas_switch_id/Makefile module/Makefile module/avl/Makefile module/nvpair/Makefile module/unicode/Makefile module/zcommon/Makefile module/zfs/Makefile module/zpios/Makefile include/Makefile include/linux/Makefile include/sys/Makefile include/sys/fs/Makefile include/sys/fm/Makefile include/sys/fm/fs/Makefile scripts/Makefile scripts/zpios-profile/Makefile scripts/zpios-test/Makefile scripts/zpool-config/Makefile scripts/zpool-layout/Makefile scripts/common.sh zfs.spec zfs-modules.spec zfs-script-config.sh&quot;
+ac_config_files=&quot;$ac_config_files Makefile dracut/Makefile dracut/90zfs/Makefile udev/Makefile udev/rules.d/Makefile etc/Makefile etc/init.d/Makefile etc/zfs/Makefile man/Makefile man/man8/Makefile lib/Makefile lib/libspl/Makefile lib/libspl/asm-generic/Makefile lib/libspl/asm-i386/Makefile lib/libspl/asm-x86_64/Makefile lib/libspl/include/Makefile lib/libspl/include/ia32/Makefile lib/libspl/include/ia32/sys/Makefile lib/libspl/include/rpc/Makefile lib/libspl/include/sys/Makefile lib/libspl/include/sys/sysevent/Makefile lib/libspl/include/sys/dktp/Makefile lib/libspl/include/util/Makefile lib/libavl/Makefile lib/libefi/Makefile lib/libnvpair/Makefile lib/libunicode/Makefile lib/libuutil/Makefile lib/libzpool/Makefile lib/libzfs/Makefile lib/libshare/Makefile cmd/Makefile cmd/zdb/Makefile cmd/zfs/Makefile cmd/zinject/Makefile cmd/zpool/Makefile cmd/ztest/Makefile cmd/zpios/Makefile cmd/mount_zfs/Makefile cmd/zpool_layout/Makefile cmd/zvol_id/Makefile cmd/zpool_id/Makefile cmd/sas_switch_id/Makefile module/Makefile module/avl/Makefile module/nvpair/Makefile module/unicode/Makefile module/zcommon/Makefile module/zfs/Makefile module/zpios/Makefile include/Makefile include/linux/Makefile include/sys/Makefile include/sys/fs/Makefile include/sys/fm/Makefile include/sys/fm/fs/Makefile scripts/Makefile scripts/zpios-profile/Makefile scripts/zpios-test/Makefile scripts/zpool-config/Makefile scripts/zpool-layout/Makefile scripts/common.sh zfs.spec zfs-modules.spec zfs-script-config.sh&quot;
 
 
 cat &gt;confcache &lt;&lt;\_ACEOF
@@ -21667,12 +21667,6 @@ do
     &quot;udev/rules.d/Makefile&quot;) CONFIG_FILES=&quot;$CONFIG_FILES udev/rules.d/Makefile&quot; ;;
     &quot;etc/Makefile&quot;) CONFIG_FILES=&quot;$CONFIG_FILES etc/Makefile&quot; ;;
     &quot;etc/init.d/Makefile&quot;) CONFIG_FILES=&quot;$CONFIG_FILES etc/init.d/Makefile&quot; ;;
-    &quot;etc/init.d/zfs.arch&quot;) CONFIG_FILES=&quot;$CONFIG_FILES etc/init.d/zfs.arch&quot; ;;
-    &quot;etc/init.d/zfs.gentoo&quot;) CONFIG_FILES=&quot;$CONFIG_FILES etc/init.d/zfs.gentoo&quot; ;;
-    &quot;etc/init.d/zfs.lunar&quot;) CONFIG_FILES=&quot;$CONFIG_FILES etc/init.d/zfs.lunar&quot; ;;
-    &quot;etc/init.d/zfs.fedora&quot;) CONFIG_FILES=&quot;$CONFIG_FILES etc/init.d/zfs.fedora&quot; ;;
-    &quot;etc/init.d/zfs.lsb&quot;) CONFIG_FILES=&quot;$CONFIG_FILES etc/init.d/zfs.lsb&quot; ;;
-    &quot;etc/init.d/zfs.redhat&quot;) CONFIG_FILES=&quot;$CONFIG_FILES etc/init.d/zfs.redhat&quot; ;;
     &quot;etc/zfs/Makefile&quot;) CONFIG_FILES=&quot;$CONFIG_FILES etc/zfs/Makefile&quot; ;;
     &quot;man/Makefile&quot;) CONFIG_FILES=&quot;$CONFIG_FILES man/Makefile&quot; ;;
     &quot;man/man8/Makefile&quot;) CONFIG_FILES=&quot;$CONFIG_FILES man/man8/Makefile&quot; ;;
diff --git a/configure.ac b/configure.ac
index 8b0f1d5..c84d60d 100644
--- a/configure.ac
+++ b/configure.ac
@@ -61,12 +61,6 @@ AC_CONFIG_FILES([
 	udev/rules.d/Makefile
 	etc/Makefile
 	etc/init.d/Makefile
-	etc/init.d/zfs.arch
-	etc/init.d/zfs.gentoo
-	etc/init.d/zfs.lunar
-	etc/init.d/zfs.fedora
-	etc/init.d/zfs.lsb
-	etc/init.d/zfs.redhat
 	etc/zfs/Makefile
 	man/Makefile
 	man/man8/Makefile
diff --git a/dracut/90zfs/.gitignore b/dracut/90zfs/.gitignore
new file mode 100644
index 0000000..6f4a5ae
--- /dev/null
+++ b/dracut/90zfs/.gitignore
@@ -0,0 +1,3 @@
+module-setup.sh
+mount-zfs.sh
+parse-zfs.sh
diff --git a/dracut/90zfs/90-zfs.rules b/dracut/90zfs/90-zfs.rules
deleted file mode 100644
index 52e1d63..0000000
--- a/dracut/90zfs/90-zfs.rules
+++ /dev/null
@@ -1,10 +0,0 @@
-SUBSYSTEM!=&quot;block&quot;, GOTO=&quot;zfs_end&quot;
-ACTION!=&quot;add|change&quot;, GOTO=&quot;zfs_end&quot;
-
-ENV{ID_FS_TYPE}==&quot;zfs&quot;, RUN+=&quot;/sbin/modprobe zfs&quot;
-ENV{ID_FS_TYPE}==&quot;zfs_member&quot;, RUN+=&quot;/sbin/modprobe zfs&quot;
-
-KERNEL==&quot;null&quot;, SYMLINK+=&quot;root&quot;
-SYMLINK==&quot;null&quot;, SYMLINK+=&quot;root&quot;
-
-LABEL=&quot;zfs_end&quot;
diff --git a/dracut/90zfs/Makefile.am b/dracut/90zfs/Makefile.am
index 605654c..4112061 100644
--- a/dracut/90zfs/Makefile.am
+++ b/dracut/90zfs/Makefile.am
@@ -1,24 +1,21 @@
 pkgdracutdir = $(datadir)/dracut/modules.d/90zfs
-dist_pkgdracut_SCRIPTS = \
-	$(top_srcdir)/dracut/90zfs/90-zfs.rules \
+pkgdracut_SCRIPTS = \
 	$(top_srcdir)/dracut/90zfs/module-setup.sh \
 	$(top_srcdir)/dracut/90zfs/mount-zfs.sh \
 	$(top_srcdir)/dracut/90zfs/parse-zfs.sh
 
-all:
-	@list='$(dist_pkgdracut_SCRIPTS)'; \
-	for file in $$list; do \
-		link=$$(basename $$file); \
-		if [ ! -e $$link ]; then \
-			$(LN_S) $$file $$link; \
-		fi \
-	done
+EXTRA_DIST = \
+	$(top_srcdir)/dracut/90zfs/module-setup.sh.in \
+	$(top_srcdir)/dracut/90zfs/mount-zfs.sh.in \
+	$(top_srcdir)/dracut/90zfs/parse-zfs.sh.in
 
-clean:
-	@list='$(dist_pkgdracut_SCRIPTS)'; \
-	for file in $$list; do \
-		link=$$(basename $$file); \
-		if [ -L $$link ]; then \
-			$(RM) $$link; \
-		fi \
-	done
+$(pkgdracut_SCRIPTS):
+	-$(SED) -e 's,@bindir\@,$(bindir),g' \
+		-e 's,@sbindir\@,$(sbindir),g' \
+		-e 's,@udevdir\@,$(udevdir),g' \
+		-e 's,@udevruledir\@,$(udevruledir),g' \
+		-e 's,@sysconfdir\@,$(sysconfdir),g' \
+		'$@.in' &gt;'$@'
+
+distclean-local::
+	-$(RM) $(pkgdracut_SCRIPTS)
diff --git a/dracut/90zfs/Makefile.in b/dracut/90zfs/Makefile.in
index b63595b..905ab50 100644
--- a/dracut/90zfs/Makefile.in
+++ b/dracut/90zfs/Makefile.in
@@ -36,8 +36,7 @@ build_triplet = @build@
 host_triplet = @host@
 target_triplet = @target@
 subdir = dracut/90zfs
-DIST_COMMON = $(dist_pkgdracut_SCRIPTS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps =  \
 	$(top_srcdir)/config/always-no-unused-but-set-variable.m4 \
@@ -111,7 +110,7 @@ am__base_list = \
   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
   sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
 am__installdirs = &quot;$(DESTDIR)$(pkgdracutdir)&quot;
-SCRIPTS = $(dist_pkgdracut_SCRIPTS)
+SCRIPTS = $(pkgdracut_SCRIPTS)
 AM_V_GEN = $(am__v_GEN_$(V))
 am__v_GEN_ = $(am__v_GEN_$(AM_DEFAULT_VERBOSITY))
 am__v_GEN_0 = @echo &quot;  GEN   &quot; $@;
@@ -292,12 +291,16 @@ top_srcdir = @top_srcdir@
 udevdir = @udevdir@
 udevruledir = @udevruledir@
 pkgdracutdir = $(datadir)/dracut/modules.d/90zfs
-dist_pkgdracut_SCRIPTS = \
-	$(top_srcdir)/dracut/90zfs/90-zfs.rules \
+pkgdracut_SCRIPTS = \
 	$(top_srcdir)/dracut/90zfs/module-setup.sh \
 	$(top_srcdir)/dracut/90zfs/mount-zfs.sh \
 	$(top_srcdir)/dracut/90zfs/parse-zfs.sh
 
+EXTRA_DIST = \
+	$(top_srcdir)/dracut/90zfs/module-setup.sh.in \
+	$(top_srcdir)/dracut/90zfs/mount-zfs.sh.in \
+	$(top_srcdir)/dracut/90zfs/parse-zfs.sh.in
+
 all: all-am
 
 .SUFFIXES:
@@ -331,10 +334,10 @@ $(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) &amp;&amp; $(MAKE) $(AM_MAKEFLAG</span><span class="stdout">S) am--refresh
 $(am__aclocal_m4_deps):
-install-dist_pkgdracutSCRIPTS: $(dist_pkgdracut_SCRIPTS)
+install-pkgdracutSCRIPTS: $(pkgdracut_SCRIPTS)
 	@$(NORMAL_INSTALL)
 	test -z &quot;$(pkgdracutdir)&quot; || $(MKDIR_P) &quot;$(DESTDIR)$(pkgdracutdir)&quot;
-	@list='$(dist_pkgdracut_SCRIPTS)'; test -n &quot;$(pkgdracutdir)&quot; || list=; \
+	@list='$(pkgdracut_SCRIPTS)'; test -n &quot;$(pkgdracutdir)&quot; || list=; \
 	for p in $$list; do \
 	  if test -f &quot;$$p&quot;; then d=; else d=&quot;$(srcdir)/&quot;; fi; \
 	  if test -f &quot;$$d$$p&quot;; then echo &quot;$$d$$p&quot;; echo &quot;$$p&quot;; else :; fi; \
@@ -357,9 +360,9 @@ install-dist_pkgdracutSCRIPTS: $(dist_pkgdracut_SCRIPTS)
 	     } \
 	; done
 
-uninstall-dist_pkgdracutSCRIPTS:
+uninstall-pkgdracutSCRIPTS:
 	@$(NORMAL_UNINSTALL)
-	@list='$(dist_pkgdracut_SCRIPTS)'; test -n &quot;$(pkgdracutdir)&quot; || exit 0; \
+	@list='$(pkgdracut_SCRIPTS)'; test -n &quot;$(pkgdracutdir)&quot; || exit 0; \
 	files=`for p in $$list; do echo &quot;$$p&quot;; done | \
 	       sed -e 's,.*/,,;$(transform)'`; \
 	test -n &quot;$$list&quot; || exit 0; \
@@ -440,11 +443,13 @@ distclean-generic:
 maintainer-clean-generic:
 	@echo &quot;This command is intended for maintainers to use&quot;
 	@echo &quot;it deletes files that may require special tools to rebuild.&quot;
+clean: clean-am
+
 clean-am: clean-generic clean-libtool mostlyclean-am
 
 distclean: distclean-am
 	-rm -f Makefile
-distclean-am: clean-am distclean-generic
+distclean-am: clean-am distclean-generic distclean-local
 
 dvi: dvi-am
 
@@ -458,7 +463,7 @@ info: info-am
 
 info-am:
 
-install-data-am: install-dist_pkgdracutSCRIPTS
+install-data-am: install-pkgdracutSCRIPTS
 
 install-dvi: install-dvi-am
 
@@ -502,41 +507,33 @@ ps: ps-am
 
 ps-am:
 
-uninstall-am: uninstall-dist_pkgdracutSCRIPTS
+uninstall-am: uninstall-pkgdracutSCRIPTS
 
 .MAKE: install-am install-strip
 
 .PHONY: all all-am check check-am clean clean-generic clean-libtool \
-	distclean distclean-generic distclean-libtool distdir dvi \
-	dvi-am html html-am info info-am install install-am \
-	install-data install-data-am install-dist_pkgdracutSCRIPTS \
-	install-dvi install-dvi-am install-exec install-exec-am \
-	install-html install-html-am install-info install-info-am \
-	install-man install-pdf install-pdf-am install-ps \
+	distclean distclean-generic distclean-libtool distclean-local \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-pkgdracutSCRIPTS install-ps \
 	install-ps-am install-strip installcheck installcheck-am \
 	installdirs maintainer-clean maintainer-clean-generic \
 	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
-	ps ps-am uninstall uninstall-am \
-	uninstall-dist_pkgdracutSCRIPTS
+	ps ps-am uninstall uninstall-am uninstall-pkgdracutSCRIPTS
 
 
-all:
-	@list='$(dist_pkgdracut_SCRIPTS)'; \
-	for file in $$list; do \
-		link=$$(basename $$file); \
-		if [ ! -e $$link ]; then \
-			$(LN_S) $$file $$link; \
-		fi \
-	done
+$(pkgdracut_SCRIPTS):
+	-$(SED) -e 's,@bindir\@,$(bindir),g' \
+		-e 's,@sbindir\@,$(sbindir),g' \
+		-e 's,@udevdir\@,$(udevdir),g' \
+		-e 's,@udevruledir\@,$(udevruledir),g' \
+		-e 's,@sysconfdir\@,$(sysconfdir),g' \
+		'$@.in' &gt;'$@'
 
-clean:
-	@list='$(dist_pkgdracut_SCRIPTS)'; \
-	for file in $$list; do \
-		link=$$(basename $$file); \
-		if [ -L $$link ]; then \
-			$(RM) $$link; \
-		fi \
-	done
+distclean-local::
+	-$(RM) $(pkgdracut_SCRIPTS)
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
diff --git a/dracut/90zfs/module-setup.sh b/dracut/90zfs/module-setup.sh
deleted file mode 100755
index 822f899..0000000
--- a/dracut/90zfs/module-setup.sh
+++ /dev/null
@@ -1,46 +0,0 @@
-#!/bin/sh
-
-check() {
-	# We depend on udev-rules being loaded
-	[ &quot;$1&quot; = &quot;-d&quot; ] &amp;&amp; return 0
-
-	# Verify the zfs tool chain
-	which zpool &gt;/dev/null 2&gt;&amp;1 || return 1
-	which zfs &gt;/dev/null 2&gt;&amp;1 || return 1
-
-	return 0
-}
-
-depends() {
-	echo udev-rules
-	return 0
-}
-
-installkernel() {
-	instmods zfs
-	instmods zcommon
-	instmods znvpair
-	instmods zavl
-	instmods zunicode
-	instmods spl
-	instmods zlib_deflate
-	instmods zlib_inflate
-}
-
-install() {
-	inst_rules &quot;$moddir/90-zfs.rules&quot;
-	inst_rules /lib/udev/rules.d/60-zpool.rules
-	inst_rules /lib/udev/rules.d/60-zvol.rules
-	inst /etc/zfs/zdev.conf
-	inst /etc/zfs/zpool.cache
-	inst /etc/hostid
-	dracut_install zfs
-	dracut_install zpool
-	dracut_install zpool_layout
-	dracut_install zpool_id
-	dracut_install zvol_id
-	dracut_install mount.zfs
-	dracut_install hostid
-	inst_hook cmdline 95 &quot;$moddir/parse-zfs.sh&quot;
-	inst_hook mount 98 &quot;$moddir/mount-zfs.sh&quot;
-}
diff --git a/dracut/90zfs/module-setup.sh.in b/dracut/90zfs/module-setup.sh.in
new file mode 100755
index 0000000..33f78e5
--- /dev/null
+++ b/dracut/90zfs/module-setup.sh.in
@@ -0,0 +1,46 @@
+#!/bin/sh
+
+check() {
+	# We depend on udev-rules being loaded
+	[ &quot;$1&quot; = &quot;-d&quot; ] &amp;&amp; return 0
+
+	# Verify the zfs tool chain
+	which zpool &gt;/dev/null 2&gt;&amp;1 || return 1
+	which zfs &gt;/dev/null 2&gt;&amp;1 || return 1
+
+	return 0
+}
+
+depends() {
+	echo udev-rules
+	return 0
+}
+
+installkernel() {
+	instmods zfs
+	instmods zcommon
+	instmods znvpair
+	instmods zavl
+	instmods zunicode
+	instmods spl
+	instmods zlib_deflate
+	instmods zlib_inflate
+}
+
+install() {
+	inst_rules @udevruledir@/90-zfs.rules
+	inst_rules @udevruledir@/60-zpool.rules
+	inst_rules @udevruledir@/60-zvol.rules
+	inst @sysconfdir@/zfs/zdev.conf
+	inst @sysconfdir@/zfs/zpool.cache
+	inst @sysconfdir@/hostid
+	dracut_install @sbindir@/zfs
+	dracut_install @sbindir@/zpool
+	dracut_install @bindir@/zpool_layout
+	dracut_install @udevdir@/zpool_id
+	dracut_install @udevdir@/zvol_id
+	dracut_install mount.zfs
+	dracut_install hostid
+	inst_hook cmdline 95 &quot;$moddir/parse-zfs.sh&quot;
+	inst_hook mount 98 &quot;$moddir/mount-zfs.sh&quot;
+}
diff --git a/dracut/90zfs/mount-zfs.sh b/dracut/90zfs/mount-zfs.sh
deleted file mode 100755
index 49d6846..0000000
--- a/dracut/90zfs/mount-zfs.sh
+++ /dev/null
@@ -1,71 +0,0 @@
-#!/bin/sh
-
-. /lib/dracut-lib.sh
-
-ZPOOL_FORCE=&quot;&quot;
-
-if getargbool 0 zfs_force -y zfs.force -y zfsforce ; then
-	warn &quot;ZFS: Will force-import pools if necessary.&quot;
-	ZPOOL_FORCE=&quot;-f&quot;
-fi
-
-case &quot;$root&quot; in
-	zfs:*)
-		# We have ZFS modules loaded, so we're able to import pools now.
-		if [ &quot;$root&quot; = &quot;zfs:AUTO&quot; ] ; then
-			# Need to parse bootfs attribute
-			info &quot;ZFS: Attempting to detect root from imported ZFS pools.&quot;
-
-			# Might be imported by the kernel module, so try searching before
-			# we import anything.
-			zfsbootfs=`zpool list -H -o bootfs | sed 'q'`
-			if [ &quot;$?&quot; != &quot;0&quot; ] || [ &quot;$zfsbootfs&quot; = &quot;&quot; ] || \
-				[ &quot;$zfsbootfs&quot; = &quot;no pools available&quot; ] ; then
-				# Not there, so we need to import everything.
-				info &quot;ZFS: Attempting to import additional pools.&quot;
-				zpool import -N -a ${ZPOOL_FORCE}
-				zfsbootfs=`zpool list -H -o bootfs | sed 'q'`
-				if [ &quot;$?&quot; != &quot;0&quot; ] || [ &quot;$zfsbootfs&quot; = &quot;&quot; ] || \
-					[ &quot;$zfsbootfs&quot; = &quot;no pools available&quot; ] ; then
-					rootok=0
-					pool=&quot;&quot;
-
-					warn &quot;ZFS: No bootfs attribute found in importable pools.&quot;
-
-					# Re-export everything since we're not prepared to take
-					# responsibility for them.
-					zpool list -H | while read fs rest ; do
-						zpool export &quot;$fs&quot;
-					done
-
-					return 1
-				fi
-			fi
-			info &quot;ZFS: Using ${zfsbootfs} as root.&quot;
-		else
-			# Should have an explicit pool set, so just import it and we're done.
-			zfsbootfs=&quot;${root#zfs:}&quot;
-			pool=&quot;${zfsbootfs%%/*}&quot;
-			if ! zpool list -H $pool &gt; /dev/null ; then
-				# pool wasn't imported automatically by the kernel module, so
-				# try it manually.
-				info &quot;ZFS: Importing pool ${pool}...&quot;
-				if ! zpool import -N ${ZPOOL_FORCE} $pool ; then
-					warn &quot;ZFS: Unable to import pool ${pool}.&quot;
-					rootok=0
-
-					return 1
-				fi
-			fi
-		fi
-
-		# Above should have left our rpool imported and pool/dataset in $root.
-		# We need zfsutil for non-legacy mounts and not for legacy mounts.
-		mountpoint=`zfs get -H -o value mountpoint $zfsbootfs`
-		if [ &quot;$mountpoint&quot; = &quot;legacy&quot; ] ; then
-			mount -t zfs &quot;$zfsbootfs&quot; &quot;$NEWROOT&quot; &amp;&amp; ROOTFS_MOUNTED=yes
-		else
-			mount -o zfsutil -t zfs &quot;$zfsbootfs&quot; &quot;$NEWROOT&quot; &amp;&amp; ROOTFS_MOUNTED=yes
-		fi
-		;;
-esac
diff --git a/dracut/90zfs/mount-zfs.sh.in b/dracut/90zfs/mount-zfs.sh.in
new file mode 100755
index 0000000..49d6846
--- /dev/null
+++ b/dracut/90zfs/mount-zfs.sh.in
@@ -0,0 +1,71 @@
+#!/bin/sh
+
+. /lib/dracut-lib.sh
+
+ZPOOL_FORCE=&quot;&quot;
+
+if getargbool 0 zfs_force -y zfs.force -y zfsforce ; then
+	warn &quot;ZFS: Will force-import pools if necessary.&quot;
+	ZPOOL_FORCE=&quot;-f&quot;
+fi
+
+case &quot;$root&quot; in
+	zfs:*)
+		# We have ZFS modules loaded, so we're able to import pools now.
+		if [ &quot;$root&quot; = &quot;zfs:AUTO&quot; ] ; then
+			# Need to parse bootfs attribute
+			info &quot;ZFS: Attempting to detect root from imported ZFS pools.&quot;
+
+			# Might be imported by the kernel module, so try searching before
+			# we import anything.
+			zfsbootfs=`zpool list -H -o bootfs | sed 'q'`
+			if [ &quot;$?&quot; != &quot;0&quot; ] || [ &quot;$zfsbootfs&quot; = &quot;&quot; ] || \
+				[ &quot;$zfsbootfs&quot; = &quot;no pools available&quot; ] ; then
+				# Not there, so we need to import everything.
+				info &quot;ZFS: Attempting to import additional pools.&quot;
+				zpool import -N -a ${ZPOOL_FORCE}
+				zfsbootfs=`zpool list -H -o bootfs | sed 'q'`
+				if [ &quot;$?&quot; != &quot;0&quot; ] || [ &quot;$zfsbootfs&quot; = &quot;&quot; ] || \
+					[ &quot;$zfsbootfs&quot; = &quot;no pools available&quot; ] ; then
+					rootok=0
+					pool=&quot;&quot;
+
+					warn &quot;ZFS: No bootfs attribute found in importable pools.&quot;
+
+					# Re-export everything since we're not prepared to take
+					# responsibility for them.
+					zpool list -H | while read fs rest ; do
+						zpool export &quot;$fs&quot;
+					done
+
+					return 1
+				fi
+			fi
+			info &quot;ZFS: Using ${zfsbootfs} as root.&quot;
+		else
+			# Should have an explicit pool set, so just import it and we're done.
+			zfsbootfs=&quot;${root#zfs:}&quot;
+			</span><span class="stdout">pool=&quot;${zfsbootfs%%/*}&quot;
+			if ! zpool list -H $pool &gt; /dev/null ; then
+				# pool wasn't imported automatically by the kernel module, so
+				# try it manually.
+				info &quot;ZFS: Importing pool ${pool}...&quot;
+				if ! zpool import -N ${ZPOOL_FORCE} $pool ; then
+					warn &quot;ZFS: Unable to import pool ${pool}.&quot;
+					rootok=0
+
+					return 1
+				fi
+			fi
+		fi
+
+		# Above should have left our rpool imported and pool/dataset in $root.
+		# We need zfsutil for non-legacy mounts and not for legacy mounts.
+		mountpoint=`zfs get -H -o value mountpoint $zfsbootfs`
+		if [ &quot;$mountpoint&quot; = &quot;legacy&quot; ] ; then
+			mount -t zfs &quot;$zfsbootfs&quot; &quot;$NEWROOT&quot; &amp;&amp; ROOTFS_MOUNTED=yes
+		else
+			mount -o zfsutil -t zfs &quot;$zfsbootfs&quot; &quot;$NEWROOT&quot; &amp;&amp; ROOTFS_MOUNTED=yes
+		fi
+		;;
+esac
diff --git a/dracut/90zfs/parse-zfs.sh b/dracut/90zfs/parse-zfs.sh
deleted file mode 100755
index 25f2dfb..0000000
--- a/dracut/90zfs/parse-zfs.sh
+++ /dev/null
@@ -1,50 +0,0 @@
-#!/bin/sh
-
-. /lib/dracut-lib.sh
-
-# Let the command line override our host id.
-spl_hostid=`getarg spl_hostid=`
-if [ &quot;${spl_hostid}&quot; != &quot;&quot; ] ; then
-	info &quot;ZFS: Using hostid from command line: ${spl_hostid}&quot;
-	echo &quot;${spl_hostid}&quot; &gt; /etc/hostid
-elif [ -f /etc/hostid ] ; then
-	info &quot;ZFS: Using hostid from /etc/hostid: `cat /etc/hostid`&quot;
-else
-	warn &quot;ZFS: No hostid found on kernel command line or /etc/hostid.  &quot;
-	warn &quot;ZFS: Pools may not import correctly.&quot;
-fi
-
-case &quot;$root&quot; in
-	&quot;&quot;|zfs|zfs:)
-		# We'll take root unset, root=zfs, or root=zfs:
-		# No root set, so we want to read the bootfs attribute.  We can't do
-		# that until udev settles so we'll set dummy values and hope for the
-		# best later on.
-		root=&quot;zfs:AUTO&quot;
-		rootok=1
-
-		info &quot;ZFS: Enabling autodetection of bootfs after udev settles.&quot;
-		;;
-
-	ZFS\=*|zfs:*|zfs:FILESYSTEM\=*|FILESYSTEM\=*)
-		# root is explicit ZFS root.  Parse it now.
-		# We can handle a root=... param in any of the following formats:
-		# root=ZFS=rpool/ROOT
-		# root=zfs:rpool/ROOT
-		# root=zfs:FILESYSTEM=rpool/ROOT
-		# root=FILESYSTEM=rpool/ROOT
-
-		# Strip down to just the pool/fs
-		root=&quot;${root#zfs:}&quot;
-		root=&quot;${root#FILESYSTEM=}&quot;
-		root=&quot;zfs:${root#ZFS=}&quot;
-		rootok=1
-
-		info &quot;ZFS: Set ${root} as bootfs.&quot;
-		;;
-esac
-
-# Make sure Dracut is happy that we have a root and will wait for ZFS
-# modules to settle before mounting.
-ln -s /dev/null /dev/root 2&gt;/dev/null
-echo '[ -e /dev/zfs ]' &gt; $hookdir/initqueue/finished/zfs.sh
diff --git a/dracut/90zfs/parse-zfs.sh.in b/dracut/90zfs/parse-zfs.sh.in
new file mode 100755
index 0000000..25f2dfb
--- /dev/null
+++ b/dracut/90zfs/parse-zfs.sh.in
@@ -0,0 +1,50 @@
+#!/bin/sh
+
+. /lib/dracut-lib.sh
+
+# Let the command line override our host id.
+spl_hostid=`getarg spl_hostid=`
+if [ &quot;${spl_hostid}&quot; != &quot;&quot; ] ; then
+	info &quot;ZFS: Using hostid from command line: ${spl_hostid}&quot;
+	echo &quot;${spl_hostid}&quot; &gt; /etc/hostid
+elif [ -f /etc/hostid ] ; then
+	info &quot;ZFS: Using hostid from /etc/hostid: `cat /etc/hostid`&quot;
+else
+	warn &quot;ZFS: No hostid found on kernel command line or /etc/hostid.  &quot;
+	warn &quot;ZFS: Pools may not import correctly.&quot;
+fi
+
+case &quot;$root&quot; in
+	&quot;&quot;|zfs|zfs:)
+		# We'll take root unset, root=zfs, or root=zfs:
+		# No root set, so we want to read the bootfs attribute.  We can't do
+		# that until udev settles so we'll set dummy values and hope for the
+		# best later on.
+		root=&quot;zfs:AUTO&quot;
+		rootok=1
+
+		info &quot;ZFS: Enabling autodetection of bootfs after udev settles.&quot;
+		;;
+
+	ZFS\=*|zfs:*|zfs:FILESYSTEM\=*|FILESYSTEM\=*)
+		# root is explicit ZFS root.  Parse it now.
+		# We can handle a root=... param in any of the following formats:
+		# root=ZFS=rpool/ROOT
+		# root=zfs:rpool/ROOT
+		# root=zfs:FILESYSTEM=rpool/ROOT
+		# root=FILESYSTEM=rpool/ROOT
+
+		# Strip down to just the pool/fs
+		root=&quot;${root#zfs:}&quot;
+		root=&quot;${root#FILESYSTEM=}&quot;
+		root=&quot;zfs:${root#ZFS=}&quot;
+		rootok=1
+
+		info &quot;ZFS: Set ${root} as bootfs.&quot;
+		;;
+esac
+
+# Make sure Dracut is happy that we have a root and will wait for ZFS
+# modules to settle before mounting.
+ln -s /dev/null /dev/root 2&gt;/dev/null
+echo '[ -e /dev/zfs ]' &gt; $hookdir/initqueue/finished/zfs.sh
diff --git a/etc/init.d/.gitignore b/etc/init.d/.gitignore
index 601a25a..73304bc 100644
--- a/etc/init.d/.gitignore
+++ b/etc/init.d/.gitignore
@@ -1,6 +1 @@
-zfs.arch
-zfs.fedora
-zfs.gentoo
-zfs.lsb
-zfs.lunar
-zfs.redhat
+zfs
diff --git a/etc/init.d/Makefile.am b/etc/init.d/Makefile.am
index 00bb268..94a2168 100644
--- a/etc/init.d/Makefile.am
+++ b/etc/init.d/Makefile.am
@@ -1,5 +1,22 @@
-EXTRA_DIST = zfs.fedora zfs.gentoo zfs.lsb zfs.lunar zfs.redhat zfs.arch
+initdir = $(DEFAULT_INIT_DIR)
+init_SCRIPTS = zfs
 
-install-data-local:
-	@instdest=$(DESTDIR)$(DEFAULT_INIT_DIR)/zfs; \
-	$(INSTALL) -TD zfs.$(DEFAULT_INIT_SCRIPT) $$instdest
+EXTRA_DIST = \
+	$(top_srcdir)/etc/init.d/zfs.fedora.in \
+	$(top_srcdir)/etc/init.d/zfs.gentoo.in \
+	$(top_srcdir)/etc/init.d/zfs.lsb.in \
+	$(top_srcdir)/etc/init.d/zfs.lunar.in \
+	$(top_srcdir)/etc/init.d/zfs.redhat.in \
+	$(top_srcdir)/etc/init.d/zfs.arch.in
+
+$(init_SCRIPTS):
+	-$(SED) -e 's,@bindir\@,$(bindir),g' \
+		-e 's,@sbindir\@,$(sbindir),g' \
+		-e 's,@udevdir\@,$(udevdir),g' \
+		-e 's,@udevruledir\@,$(udevruledir),g' \
+		-e 's,@sysconfdir\@,$(sysconfdir),g' \
+		-e 's,@initdir\@,$(initdir),g' \
+		'zfs.$(DEFAULT_INIT_SCRIPT).in' &gt;'$@'
+
+distclean-local::
+	-$(RM) $(init_SCRIPTS)
diff --git a/etc/init.d/Makefile.in b/etc/init.d/Makefile.in
index 6ca2e27..32c73dc 100644
--- a/etc/init.d/Makefile.in
+++ b/etc/init.d/Makefile.in
@@ -14,6 +14,7 @@
 # PARTICULAR PURPOSE.
 
 @SET_MAKE@
+
 VPATH = @srcdir@
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
@@ -35,10 +36,7 @@ build_triplet = @build@
 host_triplet = @host@
 target_triplet = @target@
 subdir = etc/init.d
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
-	$(srcdir)/zfs.arch.in $(srcdir)/zfs.fedora.in \
-	$(srcdir)/zfs.gentoo.in $(srcdir)/zfs.lsb.in \
-	$(srcdir)/zfs.lunar.in $(srcdir)/zfs.redhat.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps =  \
 	$(top_srcdir)/config/always-no-unused-but-set-variable.m4 \
@@ -88,9 +86,31 @@ am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/zfs_config.h
-CONFIG_CLEAN_FILES = zfs.arch zfs.gentoo zfs.lunar zfs.fedora zfs.lsb \
-	zfs.redhat
+CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+am__vpath_adj_setup = srcdirstrip=`echo &quot;$(srcdir)&quot; | sed 's|.|.|g'`;
+am__vpath_adj = case $$p in \
+    $(srcdir)/*) f=`echo &quot;$$p&quot; | sed &quot;s|^$$srcdirstrip/||&quot;`;; \
+    *) f=$$p;; \
+  esac;
+am__strip_dir = f=`echo $$p | sed -e 's|^.*/||'`;
+am__install_max = 40
+am__nobase_strip_setup = \
+  srcdirstrip=`echo &quot;$(srcdir)&quot; | sed 's/[].[^$$\\*|]/\\\\&amp;/g'`
+am__nobase_strip = \
+  for p in $$list; do echo &quot;$$p&quot;; done | sed -e &quot;s|$$srcdirstrip/||&quot;
+am__nobase_list = $(am__nobase_strip_setup); \
+  for p in $$list; do echo &quot;$$p $$p&quot;; done | \
+  sed &quot;s| $$srcdirstrip/| |;&quot;' / .*\//!s/ .*/ ./; s,\( .*\)/[^/]*$$,\1,' | \
+  $(AWK) 'BEGIN { files[&quot;.&quot;] = &quot;&quot; } { files[$$2] = files[$$2] &quot; &quot; $$1; \
+    if (++n[$$2] == $(am__install_max)) \
+      { print $$2, files[$$2]; n[$$2] = 0; files[$$2] = &quot;&quot; } } \
+    END { for (dir in files) print dir, files[dir] }'
+am__base_list = \
+  sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\n/ /g' | \
+  sed '$$!N;$$!N;$$!N;$$!N;s/\n/ /g'
+am__installdirs = &quot;$(DESTDIR)$(initdir)&quot;
+SCRIPTS = $(init_SCRIPTS)
 AM_V_GEN = $(am__v_GEN_$(V))
 am__v_GEN_ = $(am__v_GEN_$(AM_DEFAULT_VERBOSITY))
 am__v_GEN_0 = @echo &quot;  GEN   &quot; $@;
@@ -270,7 +290,16 @@ top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 udevdir = @udevdir@
 udevruledir = @udevruledir@
-EXTRA_DIST = zfs.fedora zfs.gentoo zfs.lsb zfs.lunar zfs.redhat zfs.arch
+initdir = $(DEFAULT_INIT_DIR)
+init_SCRIPTS = zfs
+EXTRA_DIST = \
+	$(top_srcdir)/etc/init.d/zfs.fedora.in \
+	$(top_srcdir)/etc/init.d/zfs.gentoo.in \
+	$(top_srcdir)/etc/init.d/zfs.lsb.in \
+	$(top_srcdir)/etc/init.d/zfs.lunar.in \
+	$(top_srcdir)/etc/init.d/zfs.redhat.in \
+	$(top_srcdir)/etc/init.d/zfs.arch.in
+
 all: all-am
 
 .SUFFIXES:
@@ -304,18 +333,40 @@ $(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
 $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 	cd $(top_builddir) &amp;&amp; $(MAKE) $(AM_MAKEFLAGS) am--refresh
 $(am__aclocal_m4_deps):
-zfs.arch: $(top_builddir)/config.status $(srcdir)/zfs.arch.in
-	cd $(top_builddir) &amp;&amp; $(SHELL) ./config.status $(subdir)/$@
-zfs.gentoo: $(top_builddir)/config.status $(srcdir)/zfs.gentoo.in
-	cd $(top_builddir) &amp;&amp; $(SHELL) ./config.status $(subdir)/$@
-zfs.lunar: $(top_builddir)/config.status $(srcdir)/zfs.lunar.in
-	cd $(top_builddir) &amp;&amp; $(SHELL) ./config.status $(subdir)/$@
-zfs.fedora: $(top_builddir)/config.status $(srcdir)/zfs.fedora.in
-	cd $(top_builddir) &amp;&amp; $(SHELL) ./config.status $(subdir)/$@
-zfs.lsb: $(top_builddir)/config.status $(srcdir)/zfs.lsb.in
-	cd $(top_builddir) &amp;&amp; $(SHELL) ./config.status $(subdir)/$@
-zfs.redhat: $(top_builddir)/config.status $(srcdir)/zfs.redhat.in
-	cd $(top_builddir) &amp;&amp; $(SHELL) ./config.status $(subdir)/$@
+install-initSCRIPTS: $(init_SCRIPTS)
+	@$(NORMAL_INSTALL)
+	test -z &quot;$(initdir)&quot; || $(MKDIR_P) &quot;$(DESTDIR)$(initdir)&quot;
+	@list='$(init_SCRIPTS)'; test -n &quot;$(initdir)&quot; || list=; \
+	for p in $$list; do \
+	  if test -f &quot;$$p&quot;; then d=; else d=&quot;$(srcdir)/&quot;; fi; \
+	  if test -f &quot;$$d$$p&quot;; then echo &quot;$$d$$p&quot;; echo &quot;$$p&quot;; else :; fi; \
+	done | \
+	sed -e 'p;s,.*/,,;n' \
+	    -e 'h;s|.*|.|' \
+	    -e 'p;x;s,.*/,,;$(transform)' | sed 'N;N;N;s,\n, ,g' | \
+	$(AWK) 'BEGIN { files[&quot;.&quot;] = &quot;&quot;; dirs[&quot;.&quot;] = 1; } \
+	  { d=$$3; if (dirs[d] != 1) { print &quot;d&quot;, d; dirs[d] = 1 } \
+	    if ($$2 == $$4) { files[d] = files[d] &quot; &quot; $$1; \
+	      if (++n[d] == $(am__install_max)) { \
+		print &quot;f&quot;, d, files[d]; n[d] = 0; files[d] = &quot;&quot; } } \
+	    else { print &quot;f&quot;, d &quot;/</span><span class="stdout">&quot; $$4, $$1 } } \
+	  END { for (d in files) print &quot;f&quot;, d, files[d] }' | \
+	while read type dir files; do \
+	     if test &quot;$$dir&quot; = .; then dir=; else dir=/$$dir; fi; \
+	     test -z &quot;$$files&quot; || { \
+	       echo &quot; $(INSTALL_SCRIPT) $$files '$(DESTDIR)$(initdir)$$dir'&quot;; \
+	       $(INSTALL_SCRIPT) $$files &quot;$(DESTDIR)$(initdir)$$dir&quot; || exit $$?; \
+	     } \
+	; done
+
+uninstall-initSCRIPTS:
+	@$(NORMAL_UNINSTALL)
+	@list='$(init_SCRIPTS)'; test -n &quot;$(initdir)&quot; || exit 0; \
+	files=`for p in $$list; do echo &quot;$$p&quot;; done | \
+	       sed -e 's,.*/,,;$(transform)'`; \
+	test -n &quot;$$list&quot; || exit 0; \
+	echo &quot; ( cd '$(DESTDIR)$(initdir)' &amp;&amp; rm -f&quot; $$files &quot;)&quot;; \
+	cd &quot;$(DESTDIR)$(initdir)&quot; &amp;&amp; rm -f $$files
 
 mostlyclean-libtool:
 	-rm -f *.lo
@@ -361,8 +412,11 @@ distdir: $(DISTFILES)
 	done
 check-am: all-am
 check: check-am
-all-am: Makefile
+all-am: Makefile $(SCRIPTS)
 installdirs:
+	for dir in &quot;$(DESTDIR)$(initdir)&quot;; do \
+	  test -z &quot;$$dir&quot; || $(MKDIR_P) &quot;$$dir&quot;; \
+	done
 install: install-am
 install-exec: install-exec-am
 install-data: install-data-am
@@ -394,7 +448,7 @@ clean-am: clean-generic clean-libtool mostlyclean-am
 
 distclean: distclean-am
 	-rm -f Makefile
-distclean-am: clean-am distclean-generic
+distclean-am: clean-am distclean-generic distclean-local
 
 dvi: dvi-am
 
@@ -408,7 +462,7 @@ info: info-am
 
 info-am:
 
-install-data-am: install-data-local
+install-data-am: install-initSCRIPTS
 
 install-dvi: install-dvi-am
 
@@ -452,26 +506,35 @@ ps: ps-am
 
 ps-am:
 
-uninstall-am:
+uninstall-am: uninstall-initSCRIPTS
 
 .MAKE: install-am install-strip
 
 .PHONY: all all-am check check-am clean clean-generic clean-libtool \
-	distclean distclean-generic distclean-libtool distdir dvi \
-	dvi-am html html-am info info-am install install-am \
-	install-data install-data-am install-data-local install-dvi \
+	distclean distclean-generic distclean-libtool distclean-local \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
 	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-ps install-ps-am \
-	install-strip installcheck installcheck-am installdirs \
-	maintainer-clean maintainer-clean-generic mostlyclean \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	uninstall uninstall-am
-
-
-install-data-local:
-	@instdest=$(DESTDIR)$(DEFAULT_INIT_DIR)/zfs; \
-	$(INSTALL) -TD zfs.$(DEFAULT_INIT_SCRIPT) $$instdest
+	install-html-am install-info install-info-am \
+	install-initSCRIPTS install-man install-pdf install-pdf-am \
+	install-ps install-ps-am install-strip installcheck \
+	installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-generic \
+	mostlyclean-libtool pdf pdf-am ps ps-am uninstall uninstall-am \
+	uninstall-initSCRIPTS
+
+
+$(init_SCRIPTS):
+	-$(SED) -e 's,@bindir\@,$(bindir),g' \
+		-e 's,@sbindir\@,$(sbindir),g' \
+		-e 's,@udevdir\@,$(udevdir),g' \
+		-e 's,@udevruledir\@,$(udevruledir),g' \
+		-e 's,@sysconfdir\@,$(sysconfdir),g' \
+		-e 's,@initdir\@,$(initdir),g' \
+		'zfs.$(DEFAULT_INIT_SCRIPT).in' &gt;'$@'
+
+distclean-local::
+	-$(RM) $(init_SCRIPTS)
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
diff --git a/etc/init.d/zfs.arch.in b/etc/init.d/zfs.arch.in
index de2ea8a..9fa7cb4 100644
--- a/etc/init.d/zfs.arch.in
+++ b/etc/init.d/zfs.arch.in
@@ -5,7 +5,7 @@
 
 ZFS=&quot;@sbindir@/zfs&quot;
 ZPOOL=&quot;@sbindir@/zpool&quot;
-ZPOOL_CACHE=&quot;@sysconfdir@/zfs/zpool.cache&quot;
+ZPOOL_CACHE=&quot;@initdir@/zpool.cache&quot;
 
 case &quot;$1&quot; in
   start)
diff --git a/etc/init.d/zfs.fedora.in b/etc/init.d/zfs.fedora.in
index 04f2077..1583a10 100644
--- a/etc/init.d/zfs.fedora.in
+++ b/etc/init.d/zfs.fedora.in
@@ -32,7 +32,7 @@ export PATH=/usr/local/sbin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin
 RETVAL=0
 ZFS=&quot;@sbindir@/zfs&quot;
 ZPOOL=&quot;@sbindir@/zpool&quot;
-ZPOOL_CACHE=&quot;@sysconfdir@/zfs/zpool.cache&quot;
+ZPOOL_CACHE=&quot;@initdir@/zpool.cache&quot;
 servicename=zfs
 LOCKFILE=/var/lock/subsys/$servicename
 
diff --git a/etc/init.d/zfs.gentoo.in b/etc/init.d/zfs.gentoo.in
index 767aba8..31a539c 100644
--- a/etc/init.d/zfs.gentoo.in
+++ b/etc/init.d/zfs.gentoo.in
@@ -13,7 +13,7 @@ depend()
 
 ZFS=&quot;@sbindir@/zfs&quot;
 ZPOOL=&quot;@sbindir@/zpool&quot;
-ZPOOL_CACHE=&quot;@sysconfdir@/zfs/zpool.cache&quot;
+ZPOOL_CACHE=&quot;@initdir@/zpool.cache&quot;
 ZFS_MODULE=zfs
 
 checksystem() {
diff --git a/etc/init.d/zfs.lsb.in b/etc/init.d/zfs.lsb.in
index c781f05..675effe 100644
--- a/etc/init.d/zfs.lsb.in
+++ b/etc/init.d/zfs.lsb.in
@@ -33,7 +33,7 @@ RETVAL=0
 LOCKFILE=/var/lock/zfs
 ZFS=&quot;@sbindir@/zfs&quot;
 ZPOOL=&quot;@sbindir@/zpool&quot;
-ZPOOL_CACHE=&quot;@sysconfdir@/zfs/zpool.cache&quot;
+ZPOOL_CACHE=&quot;@initdir@/zpool.cache&quot;
 
 [ -x $ZPOOL ] || exit 1
 [ -x $ZFS ] || exit 2
diff --git a/etc/init.d/zfs.lunar.in b/etc/init.d/zfs.lunar.in
index 97384dc..22df3d2 100644
--- a/etc/init.d/zfs.lunar.in
+++ b/etc/init.d/zfs.lunar.in
@@ -12,7 +12,7 @@
 
 ZFS=&quot;@sbindir@/zfs&quot;
 ZPOOL=&quot;@sbindir@/zpool&quot;
-ZPOOL_CACHE=&quot;@sysconfdir@/zfs/zpool.cache&quot;
+ZPOOL_CACHE=&quot;@initdir@/zpool.cache&quot;
 
 case $1 in
   start)  echo &quot;$1ing ZFS filesystems&quot;
diff --git a/etc/init.d/zfs.redhat.in b/etc/init.d/zfs.redhat.in
index ae797c1..2b48e95 100644
--- a/etc/init.d/zfs.redhat.in
+++ b/etc/init.d/zfs.redhat.in
@@ -32,7 +32,7 @@ export PATH=/usr/local/sbin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin
 RETVAL=0
 ZFS=&quot;@sbindir@/zfs&quot;
 ZPOOL=&quot;@sbindir@/zpool&quot;
-ZPOOL_CACHE=&quot;@sysconfdir@/zfs/zpool.cache&quot;
+ZPOOL_CACHE=&quot;@initdir@/zpool.cache&quot;
 servicename=zfs
 LOCKFILE=/var/lock/subsys/$servicename
 
diff --git a/module/zfs/zpl_file.c b/module/zfs/zpl_file.c
index 53921d1..af46afd 100644
--- a/module/zfs/zpl_file.c
+++ b/module/zfs/zpl_file.c
@@ -305,7 +305,8 @@ static int
 zpl_readpages(struct file *filp, struct address_space *mapping,
 	struct list_head *pages, unsigned nr_pages)
 {
-	return (read_cache_pages(mapping, pages, zpl_readpage, filp));
+	return (read_cache_pages(mapping, pages,
+	    (filler_t *)zpl_readpage, filp));
 }
 
 int
diff --git a/udev/rules.d/.gitignore b/udev/rules.d/.gitignore
index e56d65e..939962d 100644
--- a/udev/rules.d/.gitignore
+++ b/udev/rules.d/.gitignore
@@ -1,2 +1,3 @@
 60-zpool.rules
 60-zvol.rules
+90-zfs.rules
diff --git a/udev/rules.d/90-zfs.rules.in b/udev/rules.d/90-zfs.rules.in
new file mode 100644
index 0000000..52e1d63
--- /dev/null
+++ b/udev/rules.d/90-zfs.rules.in
@@ -0,0 +1,10 @@
+SUBSYSTEM!=&quot;block&quot;, GOTO=&quot;zfs_end&quot;
+ACTION!=&quot;add|change&quot;, GOTO=&quot;zfs_end&quot;
+
+ENV{ID_FS_TYPE}==&quot;zfs&quot;, RUN+=&quot;/sbin/modprobe zfs&quot;
+ENV{ID_FS_TYPE}==&quot;zfs_member&quot;, RUN+=&quot;/sbin/modprobe zfs&quot;
+
+KERNEL==&quot;null&quot;, SYMLINK+=&quot;root&quot;
+SYMLINK==&quot;null&quot;, SYMLINK+=&quot;root&quot;
+
+LABEL=&quot;zfs_end&quot;
diff --git a/udev/rules.d/Makefile.am b/udev/rules.d/Makefile.am
index 4174051..bb4eedf 100644
--- a/udev/rules.d/Makefile.am
+++ b/udev/rules.d/Makefile.am
@@ -1,14 +1,20 @@
 udevrule_DATA = \
-	60-zpool.rules \
-	60-zvol.rules
+	$(top_srcdir)/udev/rules.d/60-zpool.rules \
+	$(top_srcdir)/udev/rules.d/60-zvol.rules \
+	$(top_srcdir)/udev/rules.d/90-zfs.rules
 
 EXTRA_DIST = \
-	60-zpool.rules.in \
-	60-zvol.rules.in
+	$(top_srcdir)/udev/rules.d/60-zpool.rules.in \
+	$(top_srcdir)/udev/rules.d/60-zvol.rules.in \
+	$(top_srcdir)/udev/rules.d/90-zfs.rules.in
 
 $(udevrule_DATA):
-	-$(SED) -e 's,@udevdir\@,$(udevdir),g' '$@.in' &gt;'$@'
+	-$(SED) -e 's,@bindir\@,$(bindir),g' \
+		-e 's,@sbindir\@,$(sbindir),g' \
+		-e 's,@udevdir\@,$(udevdir),g' \
+		-e 's,@udevruledir\@,$(udevruledir),g' \
+		-e 's,@sysconfdir\@,$(sysconfdir),g' \
+		'$@.in' &gt;'$@'
 
 distclean-local::
 	-$(RM) $(udevrule_DATA)
-
diff --git a/udev/rules.d/Makefile.in b/udev/rules.d/Makefile.in
index 06ef0a9..a91f67e 100644
--- a/udev/rules.d/Makefile.in
+++ b/udev/rules.d/Makefile.in
@@ -291,12 +291,14 @@ top_srcdir = @top_srcdir@
 udevdir = @udevdir@
 udevruledir = @udevruledir@
 udevrule_DATA = \
-	60-zpool.rules \
-	60-zvol.rules
+	$(top_srcdir)/udev/rules.d/60-zpool.rules \
+	$(top_srcdir)/udev/rules.d/60-zvol.rules \
+	$(top_srcdir)/udev/rules.d/90-zfs.rules
 
 EXTRA_DIST = \
-	60-zpool.rules.in \
-	60-zvol.rules.in
+	$(top_srcdir)/udev/rules.d/60-zpool.rules.in \
+	$(top_srcdir)/udev/rules.d/60-zvol.rules.in \
+	$(top_srcdir)/udev/rules.d/90-zfs.rules.in
 
 all: all-am
 
@@ -509,7 +511,12 @@ uninstall-am: uninstall-udevruleDATA
 
 
 $(udevrule_DATA):
-	-$(SED) -e 's,@udevdir\@,$(udevdir),g' '$@.in' &gt;'$@'
+	-$(SED) -e 's,@bindir\@,$(bindir),g' \
+		-e 's,@sbindir\@,$(sbindir),g' \
+		-e 's,@udevdir\@,$(udevdir),g' \
+		-e 's,@udevruledir\@,$(udevruledir),g' \
+		-e 's,@sysconfdir\@,$(sysconfdir),g' \
+		'$@.in' &gt;'$@'
 
 distclean-local::
 	-$(RM) $(udevrule_DATA)
diff --git a/zfs.spec.in b/zfs.spec.in
index 56e8c47..3f3142a 100644
--- a/zfs.spec.in
+++ b/zfs.spec.in
@@ -82,7 +82,6 @@ rm -rf $RPM_BUILD_ROOT
 %{_sysconfdir}/init.d/*
 %{_sysconfdir}/zfs/*
 %{_udevdir}/*
-%{_udevdir}/rules.d/*
 
 %files devel
 %defattr(-,root,root)
</span></pre>
</body>
<!-- Mirrored from pip.chaos:8010/builders/Ubuntu 11.10 (Oneiric) Desktop - AMD64/builds/175/steps/git_1/logs/patch by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 22 Aug 2011 19:29:25 GMT -->
</html>
